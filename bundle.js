(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Rectangle_1 = require("./Rectangle");
var Grid = (function () {
    function Grid(block_size, color, lineWidth) {
        if (color === void 0) { color = "blue"; }
        if (lineWidth === void 0) { lineWidth = 2; }
        this.blockSize = block_size;
        this.color = color;
        this.lineWidth = lineWidth;
        this.lastX = 0;
        this.lastY = 0;
        this.cells = new Array();
    }
    Grid.prototype.generate = function (maxX, maxY) {
        var horizontalBlocks = maxX / this.blockSize;
        var verticalBlocks = maxY / this.blockSize;
        // The gridSize should be the smaller of the two
        this.gridSize = Math.round((horizontalBlocks > verticalBlocks ? verticalBlocks : horizontalBlocks));
        var blocksToDraw = (this.gridSize * this.gridSize);
        var blockCount = 0;
        while (blockCount < blocksToDraw) {
            this.cells.push(new Rectangle_1.Rectangle(this.lastX, this.lastY, this.blockSize, this.blockSize));
            if (this.currentBlockRight > this.totalGridSize) {
                this.lastY += this.blockSize;
                this.lastX = 0;
            }
            else
                this.lastX += this.blockSize + this.lineWidth;
            blockCount++;
        }
        return this.cells;
    };
    Grid.prototype.draw = function (ctx, maxX, maxY) {
        var _this = this;
        ctx.lineWidth = 1;
        ctx.strokeStyle = this.color;
        if (this.cells) {
            this.cells.forEach(function (cell) {
                _this.drawGridBlock(ctx, cell);
            });
        }
    };
    Grid.prototype.drawGridBlock = function (ctx, block) {
        ctx.strokeRect(block.x, block.y, block.width, block.height);
    };
    Object.defineProperty(Grid.prototype, "totalGridSize", {
        get: function () {
            return (this.gridSize * this.blockSize);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Grid.prototype, "currentBlockRight", {
        get: function () {
            return ((this.lastX + this.lineWidth) + this.blockSize);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Grid.prototype, "currentBlockBottom", {
        get: function () {
            return (this.lastY + this.lineWidth) + this.blockSize;
        },
        enumerable: true,
        configurable: true
    });
    return Grid;
}());
exports.Grid = Grid;
},{"./Rectangle":2}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Rectangle = (function () {
    function Rectangle(x, y, width, height, color, lineWidth) {
        if (color === void 0) { color = "white"; }
        if (lineWidth === void 0) { lineWidth = 3; }
        this.x = x;
        this.y = y;
        this.width = width;
        this.height = height;
        this.color = color;
        this.lineWidth = lineWidth;
    }
    Rectangle.prototype.draw = function (ctx, maxX, maxY) {
        this.scrollLeft(maxX);
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
    };
    Rectangle.prototype.scrollLeft = function (wrapX) {
        this.x = this.x - this.width;
        if ((this.x + this.width) <= 0)
            this.x = wrapX;
    };
    return Rectangle;
}());
exports.Rectangle = Rectangle;
},{}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Snake = (function () {
    function Snake(grid) {
        this.direction = "left";
        this.grid = grid;
        this.snakeCells = new Array();
        this.snakeCells.push(this.grid[0]);
        this.snakeCells.push(this.grid[1]);
        this.snakeCells.push(this.grid[2]);
    }
    Snake.prototype.draw = function (ctx, maxX, maxY) {
        var _this = this;
        ctx.fillStyle = "red";
        for (var i = 0; i < this.snakeCells.length; i++) {
            ctx.fillRect(this.snakeCells[i].x, this.snakeCells[i].y, this.snakeCells[i].width, this.snakeCells[i].height);
            switch (this.direction) {
                case "left": {
                    debugger;
                    // Move the snake cell to the previous x-cell in the grid
                    var leftCells = this.grid.filter(function (gc) { return gc.y == _this.snakeCells[i].y && gc.x < _this.snakeCells[i].x; });
                    var leftGridCellIndex = this.searchClosestGridCellIndex(this.snakeCells[i].x, leftCells);
                    if ((leftGridCellIndex < 0) || leftCells[leftGridCellIndex].x == this.snakeCells[i].x) {
                        var rightCells = this.grid.filter(function (gc) { return gc.y == _this.snakeCells[i].y && gc.x > _this.snakeCells[i].x; });
                        this.snakeCells[i].x = rightCells[rightCells.length - 1].x;
                    }
                    else
                        this.snakeCells[i].x = leftCells[leftGridCellIndex].x; //this.getNextLeftGridCell(this.snakeCells[i].x, this.snakeCells[i].y).x;
                }
            }
        }
    };
    // Find the closest grid cell from our current x position
    Snake.prototype.searchClosestGridCellIndex = function (currentX, gridArray) {
        if (gridArray.length == 0)
            return -1;
        var currentIndex = 0; // number = gridArray[0].x;
        var currentValue = gridArray[0].x;
        for (var i = 0; i < gridArray.length; i++) {
            if (Math.abs(gridArray[currentIndex].x - gridArray[i].x) < Math.abs(currentX - gridArray[currentIndex].x))
                currentIndex = i;
        }
        ;
        return currentIndex;
    };
    Snake.prototype.getNextLeftGridCell = function (x, y) {
        var leftCells = this.grid.filter(function (gc) { return gc.y == y && gc.x < x; });
        if (leftCells && leftCells.length > 0) {
            // Find the closest x position in the grid
            return leftCells[0];
        }
        else {
            var rightCells = this.grid.filter(function (gc) { return gc.y == y && gc.x > x; });
            var mostRight = x;
            rightCells.forEach(function (rc) {
                if (rc.x > mostRight)
                    mostRight = rc.x;
            });
            return rightCells.filter(function (rc) { return rc.x == mostRight; })[0];
        }
    };
    return Snake;
}());
exports.Snake = Snake;
},{}],4:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Grid_1 = require("./Grid");
var Snake_1 = require("./Snake");
var Rectangle_1 = require("./Rectangle");
var canvas;
var ctx;
var grid = new Grid_1.Grid(100);
var snake;
var rect;
function gameLoop() {
    var interval = setInterval(function () {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, 1280, 720);
        //rect.draw(ctx, 1280, 720);
        grid.draw(ctx, 1280, 720);
        snake.draw(ctx, 1280, 720);
    }, 100);
}
window.onload = function () {
    canvas = document.getElementById('cnvs');
    ctx = canvas.getContext("2d");
    var gridCells = grid.generate(1280, 720);
    snake = new Snake_1.Snake(gridCells);
    rect = new Rectangle_1.Rectangle(100, 100, 50, 50, "blue");
    requestAnimationFrame(gameLoop);
};
},{"./Grid":1,"./Rectangle":2,"./Snake":3}]},{},[4])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJHcmlkLnRzIiwiUmVjdGFuZ2xlLnRzIiwiU25ha2UudHMiLCJhcHAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0NBLHlDQUF3QztBQUV4QztJQThESSxjQUFZLFVBQWtCLEVBQUUsS0FBc0IsRUFBRSxTQUFxQjtRQUE3QyxzQkFBQSxFQUFBLGNBQXNCO1FBQUUsMEJBQUEsRUFBQSxhQUFxQjtRQUN6RSxJQUFJLENBQUMsU0FBUyxHQUFHLFVBQVUsQ0FBQztRQUM1QixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztRQUMzQixJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNmLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ2YsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLEtBQUssRUFBYSxDQUFDO0lBQ3hDLENBQUM7SUFuRUQsdUJBQVEsR0FBUixVQUFTLElBQVksRUFBRSxJQUFZO1FBQy9CLElBQUksZ0JBQWdCLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDN0MsSUFBSSxjQUFjLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDM0MsZ0RBQWdEO1FBQ2hELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLGdCQUFnQixHQUFHLGNBQWMsR0FBRyxjQUFjLEdBQUcsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1FBRXBHLElBQUksWUFBWSxHQUFXLENBQUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDM0QsSUFBSSxVQUFVLEdBQVcsQ0FBQyxDQUFDO1FBQzNCLE9BQU0sVUFBVSxHQUFHLFlBQVksRUFBRSxDQUFDO1lBRTlCLElBQUksQ0FBQyxLQUFLLENBQUMs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QztJQUN6QyxLQUFLLEdBQUcsSUFBSSxhQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDN0IsSUFBSSxHQUFHLElBQUkscUJBQVMsQ0FBQyxHQUFHLEVBQUMsR0FBRyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDOUMscUJBQXFCLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDbkMsQ0FBQyxDQUFBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImltcG9ydCB7IElTaGFwZSB9IGZyb20gJy4vSVNoYXBlJztcclxuaW1wb3J0IHsgUmVjdGFuZ2xlIH0gZnJvbSBcIi4vUmVjdGFuZ2xlXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgR3JpZCBpbXBsZW1lbnRzIElTaGFwZSB7XHJcblxyXG4gICAgZ2VuZXJhdGUobWF4WDogbnVtYmVyLCBtYXhZOiBudW1iZXIpOiBSZWN0YW5nbGVbXSB7XHJcbiAgICAgICAgdmFyIGhvcml6b250YWxCbG9ja3MgPSBtYXhYIC8gdGhpcy5ibG9ja1NpemU7XHJcbiAgICAgICAgdmFyIHZlcnRpY2FsQmxvY2tzID0gbWF4WSAvIHRoaXMuYmxvY2tTaXplO1xyXG4gICAgICAgIC8vIFRoZSBncmlkU2l6ZSBzaG91bGQgYmUgdGhlIHNtYWxsZXIgb2YgdGhlIHR3b1xyXG4gICAgICAgIHRoaXMuZ3JpZFNpemUgPSBNYXRoLnJvdW5kKChob3Jpem9udGFsQmxvY2tzID4gdmVydGljYWxCbG9ja3MgPyB2ZXJ0aWNhbEJsb2NrcyA6IGhvcml6b250YWxCbG9ja3MpKTtcclxuXHJcbiAgICAgICAgdmFyIGJsb2Nrc1RvRHJhdzogbnVtYmVyID0gKHRoaXMuZ3JpZFNpemUgKiB0aGlzLmdyaWRTaXplKTtcclxuICAgICAgICB2YXIgYmxvY2tDb3VudDogbnVtYmVyID0gMDtcclxuICAgICAgICB3aGlsZShibG9ja0NvdW50IDwgYmxvY2tzVG9EcmF3KSB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLmNlbGxzLnB1c2gobmV3IFJlY3RhbmdsZSh0aGlzLmxhc3RYLCB0aGlzLmxhc3RZLCB0aGlzLmJsb2NrU2l6ZSwgdGhpcy5ibG9ja1NpemUpKTtcclxuXHJcbiAgICAgICAgICAgIGlmKCB0aGlzLmN1cnJlbnRCbG9ja1JpZ2h0ID4gdGhpcy50b3RhbEdyaWRTaXplKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RZICs9IHRoaXMuYmxvY2tTaXplO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0WCA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIHRoaXMubGFzdFggKz0gdGhpcy5ibG9ja1NpemUgKyB0aGlzLmxpbmVXaWR0aDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGJsb2NrQ291bnQrKztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2VsbHM7XHJcbiAgICB9IFxyXG5cclxuICAgIGRyYXcoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsIG1heFg6IG51bWJlciwgbWF4WTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDE7XHJcbiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5jb2xvcjtcclxuICAgICAgICBpZih0aGlzLmNlbGxzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2VsbHMuZm9yRWFjaChjZWxsID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZHJhd0dyaWRCbG9jayhjdHgsIGNlbGwpOyAgICBcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZHJhd0dyaWRCbG9jayhjdHg6IGFueSwgYmxvY2s6IFJlY3RhbmdsZSk6IHZvaWQge1xyXG4gICAgICAgIGN0eC5zdHJva2VSZWN0KGJsb2NrLngsIGJsb2NrLnksIGJsb2NrLndpZHRoLCBibG9jay5oZWlnaHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0IHRvdGFsR3JpZFNpemUoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gKHRoaXMuZ3JpZFNpemUgKiB0aGlzLmJsb2NrU2l6ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXQgY3VycmVudEJsb2NrUmlnaHQoKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gKCh0aGlzLmxhc3RYICsgdGhpcy5saW5lV2lkdGgpICsgdGhpcy5ibG9ja1NpemUpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0IGN1cnJlbnRCbG9ja0JvdHRvbSgpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiAodGhpcy5sYXN0WSArIHRoaXMubGluZVdpZHRoKSArIHRoaXMuYmxvY2tTaXplO1xyXG4gICAgfVxyXG5cclxuICAgIGxhc3RYOiBudW1iZXI7XHJcbiAgICBsYXN0WTogbnVtYmVyO1xyXG4gICAgeDogbnVtYmVyO1xyXG4gICAgeTogbnVtYmVyO1xyXG4gICAgY29sb3I6IHN0cmluZztcclxuICAgIGxpbmVXaWR0aDogbnVtYmVyO1xyXG4gICAgYmxvY2tTaXplOiBudW1iZXI7XHJcbiAgICBncmlkU2l6ZTogbnVtYmVyO1xyXG4gICAgY2VsbHM6IFJlY3RhbmdsZVtdO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGJsb2NrX3NpemU6IG51bWJlciwgY29sb3I6IHN0cmluZyA9IFwiYmx1ZVwiLCBsaW5lV2lkdGg6IG51bWJlciA9IDIpIHtcclxuICAgICAgICB0aGlzLmJsb2NrU2l6ZSA9IGJsb2NrX3NpemU7XHJcbiAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yO1xyXG4gICAgICAgIHRoaXMubGluZVdpZHRoID0gbGluZVdpZHRoO1xyXG4gICAgICAgIHRoaXMubGFzdFggPSAwO1xyXG4gICAgICAgIHRoaXMubGFzdFkgPSAwO1xyXG4gICAgICAgIHRoaXMuY2VsbHMgPSBuZXcgQXJyYXk8UmVjdGFuZ2xlPigpO1xyXG4gICAgfVxyXG5cclxuXHJcbn0iLCJpbXBvcnQgeyBJU2hhcGUgfSBmcm9tIFwiLi9JU2hhcGVcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBSZWN0YW5nbGUgaW1wbGVtZW50cyBJU2hhcGUge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHg6IG51bWJlciwgeTogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgY29sb3I6IHN0cmluZyA9IFwid2hpdGVcIiwgbGluZVdpZHRoOiBudW1iZXIgPSAzKSB7XHJcbiAgICAgICAgdGhpcy54ID0geDtcclxuICAgICAgICB0aGlzLnkgPSB5O1xyXG4gICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDtcclxuICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDtcclxuICAgICAgICB0aGlzLmNvbG9yID0gY29sb3I7XHJcbiAgICAgICAgdGhpcy5saW5lV2lkdGggPSBsaW5lV2lkdGg7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGRyYXcoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsIG1heFg6IG51bWJlciwgbWF4WTogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5zY3JvbGxMZWZ0KG1heFgpO1xyXG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLmNvbG9yO1xyXG4gICAgICAgIGN0eC5maWxsUmVjdCh0aGlzLngsIHRoaXMueSwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHNjcm9sbExlZnQod3JhcFg6IG51bWJlcik6IHZvaWQge1xyXG4gICAgICAgIHRoaXMueCA9IHRoaXMueCAtIHRoaXMud2lkdGg7XHJcbiAgICAgICAgaWYoICh0aGlzLnggKyB0aGlzLndpZHRoKSA8PSAwKVxyXG4gICAgICAgICAgICB0aGlzLnggPSB3cmFwWDtcclxuICAgICAgICBcclxuICAgIH1cclxuICAgIFxyXG4gICAgd2lkdGg6IG51bWJlcjtcclxuICAgIGhlaWdodDogbnVtYmVyO1xyXG4gICAgeDogbnVtYmVyO1xyXG4gICAgeTogbnVtYmVyO1xyXG4gICAgY29sb3I6IHN0cmluZztcclxuICAgIGxpbmVXaWR0aDogbnVtYmVyO1xyXG5cclxuXHJcbn0iLCJpbXBvcnQgeyBSZWN0YW5nbGUgfSBmcm9tIFwiLi9SZWN0YW5nbGVcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBTbmFrZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihncmlkOiBSZWN0YW5nbGVbXSkge1xyXG4gICAgICAgIHRoaXMuZ3JpZCA9IGdyaWQ7XHJcbiAgICAgICAgdGhpcy5zbmFrZUNlbGxzID0gbmV3IEFycmF5PFJlY3RhbmdsZT4oKTtcclxuICAgICAgICB0aGlzLnNuYWtlQ2VsbHMucHVzaCh0aGlzLmdyaWRbMF0pO1xyXG4gICAgICAgIHRoaXMuc25ha2VDZWxscy5wdXNoKHRoaXMuZ3JpZFsxXSk7XHJcbiAgICAgICAgdGhpcy5zbmFrZUNlbGxzLnB1c2godGhpcy5ncmlkWzJdKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRyYXcoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsIG1heFg6IG51bWJlciwgbWF4WTogbnVtYmVyKSB7XHJcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IFwicmVkXCI7XHJcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaTx0aGlzLnNuYWtlQ2VsbHMubGVuZ3RoO2krKykgIHtcclxuICAgICAgICAgXHJcbiAgICAgICAgICAgIGN0eC5maWxsUmVjdCh0aGlzLnNuYWtlQ2VsbHNbaV0ueCwgdGhpcy5zbmFrZUNlbGxzW2ldLnksICB0aGlzLnNuYWtlQ2VsbHNbaV0ud2lkdGgsIHRoaXMuc25ha2VDZWxsc1tpXS5oZWlnaHQpO1xyXG5cclxuXHJcbiAgICAgICAgICAgIHN3aXRjaCh0aGlzLmRpcmVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcImxlZnRcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlYnVnZ2VyO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIE1vdmUgdGhlIHNuYWtlIGNlbGwgdG8gdGhlIHByZXZpb3VzIHgtY2VsbCBpbiB0aGUgZ3JpZFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsZWZ0Q2VsbHM6IFJlY3RhbmdsZVtdID0gdGhpcy5ncmlkLmZpbHRlcihnYyA9PiBnYy55ID09IHRoaXMuc25ha2VDZWxsc1tpXS55ICYmIGdjLnggPCB0aGlzLnNuYWtlQ2VsbHNbaV0ueCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxlZnRHcmlkQ2VsbEluZGV4OiBudW1iZXIgPSB0aGlzLnNlYXJjaENsb3Nlc3RHcmlkQ2VsbEluZGV4KHRoaXMuc25ha2VDZWxsc1tpXS54LCBsZWZ0Q2VsbHMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICgobGVmdEdyaWRDZWxsSW5kZXggPCAwKSB8fCBsZWZ0Q2VsbHNbbGVmdEdyaWRDZWxsSW5kZXhdLnggPT0gdGhpcy5zbmFrZUNlbGxzW2ldLngpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByaWdodENlbGxzOiBSZWN0YW5nbGVbXSA9IHRoaXMuZ3JpZC5maWx0ZXIoZ2MgPT4gZ2MueSA9PSB0aGlzLnNuYWtlQ2VsbHNbaV0ueSAmJiBnYy54ID4gdGhpcy5zbmFrZUNlbGxzW2ldLngpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zbmFrZUNlbGxzW2ldLnggPSByaWdodENlbGxzW3JpZ2h0Q2VsbHMubGVuZ3RoIC0gMV0ueDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNuYWtlQ2VsbHNbaV0ueCA9IGxlZnRDZWxsc1tsZWZ0R3JpZENlbGxJbmRleF0ueDsgIC8vdGhpcy5nZXROZXh0TGVmdEdyaWRDZWxsKHRoaXMuc25ha2VDZWxsc1tpXS54LCB0aGlzLnNuYWtlQ2VsbHNbaV0ueSkueDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBcclxuXHJcbiAgICAvLyBGaW5kIHRoZSBjbG9zZXN0IGdyaWQgY2VsbCBmcm9tIG91ciBjdXJyZW50IHggcG9zaXRpb25cclxuICAgIHByaXZhdGUgc2VhcmNoQ2xvc2VzdEdyaWRDZWxsSW5kZXgoY3VycmVudFg6IG51bWJlciwgZ3JpZEFycmF5OiBSZWN0YW5nbGVbXSk6IG51bWJlciB7XHJcbiAgICAgICBcclxuICAgICAgIGlmKGdyaWRBcnJheS5sZW5ndGggPT0gMClcclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICB2YXIgY3VycmVudEluZGV4OiBudW1iZXIgPSAwOyAvLyBudW1iZXIgPSBncmlkQXJyYXlbMF0ueDtcclxuICAgICAgIHZhciBjdXJyZW50VmFsdWU6IG51bWJlciA9IGdyaWRBcnJheVswXS54O1xyXG4gICAgICAgZm9yKHZhciBpOiBudW1iZXIgPSAwO2k8Z3JpZEFycmF5Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgaWYgKE1hdGguYWJzKGdyaWRBcnJheVtjdXJyZW50SW5kZXhdLnggLSBncmlkQXJyYXlbaV0ueCkgPCBNYXRoLmFicyhjdXJyZW50WCAtIGdyaWRBcnJheVtjdXJyZW50SW5kZXhdLngpKVxyXG4gICAgICAgICAgICBjdXJyZW50SW5kZXggPSBpO1xyXG4gICAgICAgfTtcclxuICAgICAgIHJldHVybiBjdXJyZW50SW5kZXg7XHJcbiAgICB9XHJcbiAgICBcclxuXHJcbiAgICBwcml2YXRlIGdldE5leHRMZWZ0R3JpZENlbGwoeDogbnVtYmVyLCB5OiBudW1iZXIpOiBSZWN0YW5nbGUge1xyXG4gICAgICAgICAgdmFyIGxlZnRDZWxsczogUmVjdGFuZ2xlW10gPSB0aGlzLmdyaWQuZmlsdGVyKGdjID0+IGdjLnkgPT0geSAmJiBnYy54IDwgeCk7XHJcbiAgICAgICAgICBpZihsZWZ0Q2VsbHMgJiYgbGVmdENlbGxzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgLy8gRmluZCB0aGUgY2xvc2VzdCB4IHBvc2l0aW9uIGluIHRoZSBncmlkXHJcbiAgICAgICAgICAgIHJldHVybiBsZWZ0Q2VsbHNbMF07XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBlbHNlIHsgLy8gaWYgd2UgY2FuJ3QgZmluZCBhbnl0aGluZyB0byB0aGUgbGVmdCwgbG9vcCBiYWNrIHRvIHRoZSBtb3N0LXJpZ2h0XHJcbiAgICAgICAgICAgIHZhciByaWdodENlbGxzOiBSZWN0YW5nbGVbXSA9IHRoaXMuZ3JpZC5maWx0ZXIoZ2MgPT4gZ2MueSA9PSB5ICYmIGdjLnggPiB4KTtcclxuICAgICAgICAgICAgdmFyIG1vc3RSaWdodDogbnVtYmVyID0geDtcclxuICAgICAgICAgICAgcmlnaHRDZWxscy5mb3JFYWNoKHJjID0+IHtcclxuICAgICAgICAgICAgICAgIGlmKHJjLnggPiBtb3N0UmlnaHQpXHJcbiAgICAgICAgICAgICAgICAgICAgbW9zdFJpZ2h0ID0gcmMueDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiByaWdodENlbGxzLmZpbHRlcihyYyA9PiByYy54ID09IG1vc3RSaWdodClbMF07XHJcbiAgICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ3JpZDogUmVjdGFuZ2xlW107XHJcbiAgICBzbmFrZUNlbGxzOiBSZWN0YW5nbGVbXTtcclxuICAgIGRpcmVjdGlvbjogc3RyaW5nID0gXCJsZWZ0XCI7XHJcblxyXG59IiwiaW1wb3J0IHsgR3JpZCB9IGZyb20gXCIuL0dyaWRcIjtcclxuaW1wb3J0IHsgU25ha2UgfSBmcm9tIFwiLi9TbmFrZVwiO1xyXG5pbXBvcnQgeyBSZWN0YW5nbGUgfSBmcm9tIFwiLi9SZWN0YW5nbGVcIjtcclxuXHJcbnZhciBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xyXG52YXIgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XHJcbnZhciBncmlkOiBHcmlkID0gbmV3IEdyaWQoMTAwKTtcclxudmFyIHNuYWtlOiBTbmFrZTtcclxudmFyIHJlY3Q6IFJlY3RhbmdsZTtcclxuXHJcbmZ1bmN0aW9uIGdhbWVMb29wKCkge1xyXG4gICAgIHZhciBpbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIFxyXG4gICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcclxuICAgICAgICBjdHguZmlsbFN0eWxlID0gXCJibGFja1wiO1xyXG4gICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCAxMjgwLCA3MjApO1xyXG4gICAgICAgIC8vcmVjdC5kcmF3KGN0eCwgMTI4MCwgNzIwKTtcclxuICAgICAgICBncmlkLmRyYXcoY3R4LCAxMjgwLCA3MjApO1xyXG4gICAgICAgIHNuYWtlLmRyYXcoY3R4LCAxMjgwLCA3MjApO1xyXG4gICAgICAgIFxyXG4gICAgIH0sIDEwMCk7XHJcblxyXG4gICBcclxufVxyXG5cclxud2luZG93Lm9ubG9hZCA9ICgpID0+IHtcclxuICAgY2FudmFzID0gPEhUTUxDYW52YXNFbGVtZW50PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbnZzJyk7XHJcbiAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XHJcbiAgIHZhciBncmlkQ2VsbHMgPSBncmlkLmdlbmVyYXRlKDEyODAsIDcyMCk7XHJcbiAgIHNuYWtlID0gbmV3IFNuYWtlKGdyaWRDZWxscyk7XHJcbiAgIHJlY3QgPSBuZXcgUmVjdGFuZ2xlKDEwMCwxMDAsIDUwLCA1MCwgXCJibHVlXCIpO1xyXG4gICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZ2FtZUxvb3ApO1xyXG59Il19
