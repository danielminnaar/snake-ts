(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Rectangle_1 = require("./Rectangle");
var Grid = (function () {
    function Grid(block_size, color, lineWidth) {
        if (color === void 0) { color = "blue"; }
        if (lineWidth === void 0) { lineWidth = 2; }
        this.blockSize = block_size;
        this.color = color;
        this.lineWidth = lineWidth;
        this.lastX = 0;
        this.lastY = 0;
        this.cells = new Array();
    }
    Grid.prototype.generate = function (maxX, maxY) {
        var horizontalBlocks = maxX / this.blockSize;
        var verticalBlocks = maxY / this.blockSize;
        // The gridSize should be the smaller of the two
        this.gridSize = Math.round((horizontalBlocks > verticalBlocks ? verticalBlocks : horizontalBlocks));
        var blocksToDraw = (this.gridSize * this.gridSize);
        var blockCount = 0;
        while (blockCount < blocksToDraw) {
            this.cells.push(new Rectangle_1.Rectangle(this.lastX, this.lastY, this.blockSize, this.blockSize));
            if (this.currentBlockRight > this.totalGridSize) {
                this.lastY += this.blockSize;
                this.lastX = 0;
            }
            else
                this.lastX += this.blockSize + this.lineWidth;
            blockCount++;
        }
        return this.cells;
    };
    Grid.prototype.draw = function (ctx, maxX, maxY) {
        var _this = this;
        ctx.lineWidth = 1;
        ctx.strokeStyle = this.color;
        if (this.cells) {
            this.cells.forEach(function (cell) {
                _this.drawGridBlock(ctx, cell);
            });
        }
    };
    Grid.prototype.drawGridBlock = function (ctx, block) {
        ctx.strokeRect(block.x, block.y, block.width, block.height);
    };
    Object.defineProperty(Grid.prototype, "totalGridSize", {
        get: function () {
            return (this.gridSize * this.blockSize);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Grid.prototype, "currentBlockRight", {
        get: function () {
            return ((this.lastX + this.lineWidth) + this.blockSize);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Grid.prototype, "currentBlockBottom", {
        get: function () {
            return (this.lastY + this.lineWidth) + this.blockSize;
        },
        enumerable: true,
        configurable: true
    });
    return Grid;
}());
exports.Grid = Grid;
},{"./Rectangle":2}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Rectangle = (function () {
    function Rectangle(x, y, width, height, color, lineWidth) {
        if (color === void 0) { color = "white"; }
        if (lineWidth === void 0) { lineWidth = 3; }
        this.x = x;
        this.y = y;
        this.width = width;
        this.height = height;
        this.color = color;
        this.lineWidth = lineWidth;
    }
    Rectangle.prototype.draw = function (ctx, maxX, maxY) {
        this.scrollLeft(maxX);
        ctx.fillStyle = this.color;
        ctx.fillRect(this.x, this.y, this.width, this.height);
    };
    Rectangle.prototype.scrollLeft = function (wrapX) {
        this.x = this.x - this.width;
        if ((this.x + this.width) <= 0)
            this.x = wrapX;
    };
    return Rectangle;
}());
exports.Rectangle = Rectangle;
},{}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Rectangle_1 = require("./Rectangle");
var Snake = (function () {
    function Snake(grid) {
        this.grid = grid;
        this.snakeCells = new Array();
        this.snakeCells.push(this.cloneCell(this.grid[0]));
        this.snakeCells.push(this.cloneCell(this.grid[1]));
        this.snakeCells.push(this.cloneCell(this.grid[2]));
    }
    Snake.prototype.cloneCell = function (original) {
        return new Rectangle_1.Rectangle(original.x, original.y, original.width, original.height);
    };
    Snake.prototype.draw = function (ctx, maxX, maxY) {
        var _this = this;
        ctx.fillStyle = "red";
        for (var i = 0; i < this.snakeCells.length; i++) {
            ctx.fillRect(this.snakeCells[i].x, this.snakeCells[i].y, this.snakeCells[i].width, this.snakeCells[i].height);
            switch (this.direction) {
                case "left": {
                    // Move the snake cell to the previous x-cell in the grid
                    this.snakeCells[i].y = this.snakeCells[0].y; // Re-align and follow the head
                    var leftCells = this.grid.filter(function (gc) { return gc.y == _this.snakeCells[i].y && gc.x < _this.snakeCells[i].x; });
                    var leftGridCellIndex = this.searchClosestGridCellIndex(this.snakeCells[i].x, leftCells);
                    if ((leftGridCellIndex < 0) || leftCells[leftGridCellIndex].x == this.snakeCells[i].x) {
                        var rightCells = this.grid.filter(function (gc) { return gc.y == _this.snakeCells[i].y && gc.x > _this.snakeCells[i].x; });
                        this.snakeCells[i].x = rightCells[rightCells.length - 1].x;
                    }
                    else
                        this.snakeCells[i].x = leftCells[leftGridCellIndex].x; //this.getNextLeftGridCell(this.snakeCells[i].x, this.snakeCells[i].y).x;
                    break;
                }
                case "right": {
                    // Move the snake cell to the next x-cell in the grid
                    this.snakeCells[i].y = this.snakeCells[this.snakeCells.length - 1].y; // Re-align and follow the head
                    var rightCells = this.grid.filter(function (gc) { return gc.y == _this.snakeCells[i].y && gc.x > _this.snakeCells[i].x; });
                    var rightGridCellIndex = this.searchClosestGridCellIndex(this.snakeCells[i].x, rightCells);
                    if ((rightGridCellIndex < 0) || rightCells[rightGridCellIndex].x == this.snakeCells[i].x) {
                        var leftCells = this.grid.filter(function (gc) { return gc.y == _this.snakeCells[i].y && gc.x < _this.snakeCells[i].x; });
                        this.snakeCells[i].x = leftCells[0].x;
                    }
                    else
                        this.snakeCells[i].x = rightCells[rightGridCellIndex].x; //this.getNextLeftGridCell(this.snakeCells[i].x, this.snakeCells[i].y).x;
                    break;
                }
                case "up": {
                    // Move the snake cell to the previous y-cell in the grid
                    this.snakeCells[i].x = this.snakeCells[0].x; // re-align and follow the head
                    var topCells = this.grid.filter(function (gc) { return gc.y < _this.snakeCells[i].y && gc.x == _this.snakeCells[i].x; });
                    var topGridCellIndex = this.searchClosestGridCellIndex(this.snakeCells[i].y, topCells);
                    if ((topGridCellIndex < 0) || topCells[topGridCellIndex].y == this.snakeCells[i].y) {
                        // We need to switch direction
                        var bottomCells = this.grid.filter(function (gc) { return gc.y > _this.snakeCells[i].y && gc.x == _this.snakeCells[i].x; });
                        this.snakeCells[i].y = bottomCells[bottomCells.length - 1].y;
                    }
                    else
                        this.snakeCells[i].y = topCells[topGridCellIndex].y;
                    break;
                }
                default: {
                }
            }
        }
    };
    // Find the closest grid cell from our current x position
    Snake.prototype.searchClosestGridCellIndex = function (currentX, gridArray) {
        if (gridArray.length == 0)
            return -1;
        var currentIndex = 0; // number = gridArray[0].x;
        var currentValue = gridArray[0].x;
        for (var i = 0; i < gridArray.length; i++) {
            if (Math.abs(gridArray[currentIndex].x - gridArray[i].x) < Math.abs(currentX - gridArray[currentIndex].x))
                currentIndex = i;
        }
        ;
        return currentIndex;
    };
    return Snake;
}());
exports.Snake = Snake;
},{"./Rectangle":2}],4:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var Grid_1 = require("./Grid");
var Snake_1 = require("./Snake");
var Rectangle_1 = require("./Rectangle");
var canvas;
var ctx;
var grid = new Grid_1.Grid(20);
var snake;
var rect;
var canvasWidth = 1280;
var canvasHeight = 720;
var drawGrid = false;
function gameLoop() {
    var interval = setInterval(function () {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvasWidth, canvasHeight);
        //rect.draw(ctx, 1280, 720);
        if (drawGrid)
            grid.draw(ctx, canvasWidth, canvasHeight);
        snake.draw(ctx, canvasWidth, canvasHeight);
    }, 100);
}
window.onload = function () {
    canvas = document.getElementById('cnvs');
    ctx = canvas.getContext("2d");
    var gridCells = grid.generate(canvasWidth, canvasHeight);
    snake = new Snake_1.Snake(gridCells);
    rect = new Rectangle_1.Rectangle(100, 100, 50, 50, "blue");
    document.addEventListener("keydown", function (e) {
        switch (e.which) {
            case 37: {
                snake.direction = "left";
                break;
            }
            case 38: {
                snake.direction = "up";
                break;
            }
            case 39: {
                snake.direction = "right";
                break;
            }
            case 40: {
                snake.direction = "down";
                break;
            }
            case 32: {
                toggleDebugMode();
                break;
            }
        }
    });
    requestAnimationFrame(gameLoop);
};
function toggleDebugMode() {
    drawGrid = (!drawGrid);
}
},{"./Grid":1,"./Rectangle":2,"./Snake":3}]},{},[4])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJHcmlkLnRzIiwiUmVjdGFuZ2xlLnRzIiwiU25ha2UudHMiLCJhcHAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7OztBQ0NBLHlDQUF3QztBQUV4QztJQThESSxjQUFZLFVBQWtCLEVBQUUsS0FBc0IsRUFBRSxTQUFxQjtRQUE3QyxzQkFBQSxFQUFBLGNBQXNCO1FBQUUsMEJBQUEsRUFBQSxhQUFxQjtRQUN6RSxJQUFJLENBQUMsU0FBUyxHQUFHLFVBQVUsQ0FBQztRQUM1QixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztRQUMzQixJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNmLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ2YsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLEtBQUssRUFBYSxDQUFDO0lBQ3hDLENBQUM7SUFuRUQsdUJBQVEsR0FBUixVQUFTLElBQVksRUFBRSxJQUFZO1FBQy9CLElBQUksZ0JBQWdCLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDN0MsSUFBSSxjQUFjLEdBQUcsSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDM0MsZ0RBQWdEO1FBQ2hELElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLGdCQUFnQixHQUFHLGNBQWMsR0FBRyxjQUFjLEdBQUcsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1FBRXBHLElBQUksWUFBWSxHQUFXLENBQUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDM0QsSUFBSSxVQUFVLEdBQVcsQ0FBQyxDQUFDO1FBQzNCLE9BQU0sVUFBVSxHQUFHLFlBQVksRUFBRSxDQUFDO1lBRTlCLElBQUksQ0FBQyxLQUFLLENBQUMs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Um9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiaW1wb3J0IHsgSVNoYXBlIH0gZnJvbSAnLi9JU2hhcGUnO1xyXG5pbXBvcnQgeyBSZWN0YW5nbGUgfSBmcm9tIFwiLi9SZWN0YW5nbGVcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBHcmlkIGltcGxlbWVudHMgSVNoYXBlIHtcclxuXHJcbiAgICBnZW5lcmF0ZShtYXhYOiBudW1iZXIsIG1heFk6IG51bWJlcik6IFJlY3RhbmdsZVtdIHtcclxuICAgICAgICB2YXIgaG9yaXpvbnRhbEJsb2NrcyA9IG1heFggLyB0aGlzLmJsb2NrU2l6ZTtcclxuICAgICAgICB2YXIgdmVydGljYWxCbG9ja3MgPSBtYXhZIC8gdGhpcy5ibG9ja1NpemU7XHJcbiAgICAgICAgLy8gVGhlIGdyaWRTaXplIHNob3VsZCBiZSB0aGUgc21hbGxlciBvZiB0aGUgdHdvXHJcbiAgICAgICAgdGhpcy5ncmlkU2l6ZSA9IE1hdGgucm91bmQoKGhvcml6b250YWxCbG9ja3MgPiB2ZXJ0aWNhbEJsb2NrcyA/IHZlcnRpY2FsQmxvY2tzIDogaG9yaXpvbnRhbEJsb2NrcykpO1xyXG5cclxuICAgICAgICB2YXIgYmxvY2tzVG9EcmF3OiBudW1iZXIgPSAodGhpcy5ncmlkU2l6ZSAqIHRoaXMuZ3JpZFNpemUpO1xyXG4gICAgICAgIHZhciBibG9ja0NvdW50OiBudW1iZXIgPSAwO1xyXG4gICAgICAgIHdoaWxlKGJsb2NrQ291bnQgPCBibG9ja3NUb0RyYXcpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMuY2VsbHMucHVzaChuZXcgUmVjdGFuZ2xlKHRoaXMubGFzdFgsIHRoaXMubGFzdFksIHRoaXMuYmxvY2tTaXplLCB0aGlzLmJsb2NrU2l6ZSkpO1xyXG5cclxuICAgICAgICAgICAgaWYoIHRoaXMuY3VycmVudEJsb2NrUmlnaHQgPiB0aGlzLnRvdGFsR3JpZFNpemUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubGFzdFkgKz0gdGhpcy5ibG9ja1NpemU7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxhc3RYID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0WCArPSB0aGlzLmJsb2NrU2l6ZSArIHRoaXMubGluZVdpZHRoO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgYmxvY2tDb3VudCsrO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5jZWxscztcclxuICAgIH0gXHJcblxyXG4gICAgZHJhdyhjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgbWF4WDogbnVtYmVyLCBtYXhZOiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICBjdHgubGluZVdpZHRoID0gMTtcclxuICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSB0aGlzLmNvbG9yO1xyXG4gICAgICAgIGlmKHRoaXMuY2VsbHMpIHtcclxuICAgICAgICAgICAgdGhpcy5jZWxscy5mb3JFYWNoKGNlbGwgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3R3JpZEJsb2NrKGN0eCwgY2VsbCk7ICAgIFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBkcmF3R3JpZEJsb2NrKGN0eDogYW55LCBibG9jazogUmVjdGFuZ2xlKTogdm9pZCB7XHJcbiAgICAgICAgY3R4LnN0cm9rZVJlY3QoYmxvY2sueCwgYmxvY2sueSwgYmxvY2sud2lkdGgsIGJsb2NrLmhlaWdodCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXQgdG90YWxHcmlkU2l6ZSgpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiAodGhpcy5ncmlkU2l6ZSAqIHRoaXMuYmxvY2tTaXplKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldCBjdXJyZW50QmxvY2tSaWdodCgpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiAoKHRoaXMubGFzdFggKyB0aGlzLmxpbmVXaWR0aCkgKyB0aGlzLmJsb2NrU2l6ZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXQgY3VycmVudEJsb2NrQm90dG9tKCk6IG51bWJlciB7XHJcbiAgICAgICAgcmV0dXJuICh0aGlzLmxhc3RZICsgdGhpcy5saW5lV2lkdGgpICsgdGhpcy5ibG9ja1NpemU7XHJcbiAgICB9XHJcblxyXG4gICAgbGFzdFg6IG51bWJlcjtcclxuICAgIGxhc3RZOiBudW1iZXI7XHJcbiAgICB4OiBudW1iZXI7XHJcbiAgICB5OiBudW1iZXI7XHJcbiAgICBjb2xvcjogc3RyaW5nO1xyXG4gICAgbGluZVdpZHRoOiBudW1iZXI7XHJcbiAgICBibG9ja1NpemU6IG51bWJlcjtcclxuICAgIGdyaWRTaXplOiBudW1iZXI7XHJcbiAgICBjZWxsczogUmVjdGFuZ2xlW107XHJcblxyXG4gICAgY29uc3RydWN0b3IoYmxvY2tfc2l6ZTogbnVtYmVyLCBjb2xvcjogc3RyaW5nID0gXCJibHVlXCIsIGxpbmVXaWR0aDogbnVtYmVyID0gMikge1xyXG4gICAgICAgIHRoaXMuYmxvY2tTaXplID0gYmxvY2tfc2l6ZTtcclxuICAgICAgICB0aGlzLmNvbG9yID0gY29sb3I7XHJcbiAgICAgICAgdGhpcy5saW5lV2lkdGggPSBsaW5lV2lkdGg7XHJcbiAgICAgICAgdGhpcy5sYXN0WCA9IDA7XHJcbiAgICAgICAgdGhpcy5sYXN0WSA9IDA7XHJcbiAgICAgICAgdGhpcy5jZWxscyA9IG5ldyBBcnJheTxSZWN0YW5nbGU+KCk7XHJcbiAgICB9XHJcblxyXG5cclxufSIsImltcG9ydCB7IElTaGFwZSB9IGZyb20gXCIuL0lTaGFwZVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFJlY3RhbmdsZSBpbXBsZW1lbnRzIElTaGFwZSB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoeDogbnVtYmVyLCB5OiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBjb2xvcjogc3RyaW5nID0gXCJ3aGl0ZVwiLCBsaW5lV2lkdGg6IG51bWJlciA9IDMpIHtcclxuICAgICAgICB0aGlzLnggPSB4O1xyXG4gICAgICAgIHRoaXMueSA9IHk7XHJcbiAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoO1xyXG4gICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0O1xyXG4gICAgICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcclxuICAgICAgICB0aGlzLmxpbmVXaWR0aCA9IGxpbmVXaWR0aDtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZHJhdyhjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgbWF4WDogbnVtYmVyLCBtYXhZOiBudW1iZXIpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLnNjcm9sbExlZnQobWF4WCk7XHJcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMuY29sb3I7XHJcbiAgICAgICAgY3R4LmZpbGxSZWN0KHRoaXMueCwgdGhpcy55LCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XHJcbiAgICB9XHJcblxyXG4gICAgc2Nyb2xsTGVmdCh3cmFwWDogbnVtYmVyKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy54ID0gdGhpcy54IC0gdGhpcy53aWR0aDtcclxuICAgICAgICBpZiggKHRoaXMueCArIHRoaXMud2lkdGgpIDw9IDApXHJcbiAgICAgICAgICAgIHRoaXMueCA9IHdyYXBYO1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG4gICAgXHJcbiAgICB3aWR0aDogbnVtYmVyO1xyXG4gICAgaGVpZ2h0OiBudW1iZXI7XHJcbiAgICB4OiBudW1iZXI7XHJcbiAgICB5OiBudW1iZXI7XHJcbiAgICBjb2xvcjogc3RyaW5nO1xyXG4gICAgbGluZVdpZHRoOiBudW1iZXI7XHJcblxyXG5cclxufSIsImltcG9ydCB7IFJlY3RhbmdsZSB9IGZyb20gXCIuL1JlY3RhbmdsZVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIFNuYWtlIHtcclxuICAgIGNvbnN0cnVjdG9yKGdyaWQ6IFJlY3RhbmdsZVtdKSB7XHJcbiAgICAgICAgdGhpcy5ncmlkID0gZ3JpZDtcclxuICAgICAgICB0aGlzLnNuYWtlQ2VsbHMgPSBuZXcgQXJyYXk8UmVjdGFuZ2xlPigpO1xyXG4gICAgICAgIHRoaXMuc25ha2VDZWxscy5wdXNoKHRoaXMuY2xvbmVDZWxsKHRoaXMuZ3JpZFswXSkpO1xyXG4gICAgICAgIHRoaXMuc25ha2VDZWxscy5wdXNoKHRoaXMuY2xvbmVDZWxsKHRoaXMuZ3JpZFsxXSkpO1xyXG4gICAgICAgIHRoaXMuc25ha2VDZWxscy5wdXNoKHRoaXMuY2xvbmVDZWxsKHRoaXMuZ3JpZFsyXSkpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgY2xvbmVDZWxsKG9yaWdpbmFsOiBSZWN0YW5nbGUpOiBSZWN0YW5nbGUge1xyXG4gICAgICAgIHJldHVybiBuZXcgUmVjdGFuZ2xlKG9yaWdpbmFsLngsIG9yaWdpbmFsLnksIG9yaWdpbmFsLndpZHRoLCBvcmlnaW5hbC5oZWlnaHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkcmF3KGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCBtYXhYOiBudW1iZXIsIG1heFk6IG51bWJlcikge1xyXG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBcInJlZFwiO1xyXG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGk8dGhpcy5zbmFrZUNlbGxzLmxlbmd0aDtpKyspICB7XHJcbiAgICAgICAgIFxyXG4gICAgICAgICAgICBjdHguZmlsbFJlY3QodGhpcy5zbmFrZUNlbGxzW2ldLngsIHRoaXMuc25ha2VDZWxsc1tpXS55LCAgdGhpcy5zbmFrZUNlbGxzW2ldLndpZHRoLCB0aGlzLnNuYWtlQ2VsbHNbaV0uaGVpZ2h0KTtcclxuXHJcblxyXG4gICAgICAgICAgICBzd2l0Y2godGhpcy5kaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJsZWZ0XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBNb3ZlIHRoZSBzbmFrZSBjZWxsIHRvIHRoZSBwcmV2aW91cyB4LWNlbGwgaW4gdGhlIGdyaWRcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNuYWtlQ2VsbHNbaV0ueSA9IHRoaXMuc25ha2VDZWxsc1swXS55OyAvLyBSZS1hbGlnbiBhbmQgZm9sbG93IHRoZSBoZWFkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxlZnRDZWxsczogUmVjdGFuZ2xlW10gPSB0aGlzLmdyaWQuZmlsdGVyKGdjID0+IGdjLnkgPT0gdGhpcy5zbmFrZUNlbGxzW2ldLnkgJiYgZ2MueCA8IHRoaXMuc25ha2VDZWxsc1tpXS54KTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbGVmdEdyaWRDZWxsSW5kZXg6IG51bWJlciA9IHRoaXMuc2VhcmNoQ2xvc2VzdEdyaWRDZWxsSW5kZXgodGhpcy5zbmFrZUNlbGxzW2ldLngsIGxlZnRDZWxscyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKChsZWZ0R3JpZENlbGxJbmRleCA8IDApIHx8IGxlZnRDZWxsc1tsZWZ0R3JpZENlbGxJbmRleF0ueCA9PSB0aGlzLnNuYWtlQ2VsbHNbaV0ueCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJpZ2h0Q2VsbHM6IFJlY3RhbmdsZVtdID0gdGhpcy5ncmlkLmZpbHRlcihnYyA9PiBnYy55ID09IHRoaXMuc25ha2VDZWxsc1tpXS55ICYmIGdjLnggPiB0aGlzLnNuYWtlQ2VsbHNbaV0ueCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNuYWtlQ2VsbHNbaV0ueCA9IHJpZ2h0Q2VsbHNbcmlnaHRDZWxscy5sZW5ndGggLSAxXS54O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc25ha2VDZWxsc1tpXS54ID0gbGVmdENlbGxzW2xlZnRHcmlkQ2VsbEluZGV4XS54OyAgLy90aGlzLmdldE5leHRMZWZ0R3JpZENlbGwodGhpcy5zbmFrZUNlbGxzW2ldLngsIHRoaXMuc25ha2VDZWxsc1tpXS55KS54O1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2FzZSBcInJpZ2h0XCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBNb3ZlIHRoZSBzbmFrZSBjZWxsIHRvIHRoZSBuZXh0IHgtY2VsbCBpbiB0aGUgZ3JpZFxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc25ha2VDZWxsc1tpXS55ID0gdGhpcy5zbmFrZUNlbGxzW3RoaXMuc25ha2VDZWxscy5sZW5ndGggLTFdLnk7IC8vIFJlLWFsaWduIGFuZCBmb2xsb3cgdGhlIGhlYWRcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmlnaHRDZWxsczogUmVjdGFuZ2xlW10gPSB0aGlzLmdyaWQuZmlsdGVyKGdjID0+IGdjLnkgPT0gdGhpcy5zbmFrZUNlbGxzW2ldLnkgJiYgZ2MueCA+IHRoaXMuc25ha2VDZWxsc1tpXS54KTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmlnaHRHcmlkQ2VsbEluZGV4OiBudW1iZXIgPSB0aGlzLnNlYXJjaENsb3Nlc3RHcmlkQ2VsbEluZGV4KHRoaXMuc25ha2VDZWxsc1tpXS54LCByaWdodENlbGxzKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKHJpZ2h0R3JpZENlbGxJbmRleCA8IDApIHx8IHJpZ2h0Q2VsbHNbcmlnaHRHcmlkQ2VsbEluZGV4XS54ID09IHRoaXMuc25ha2VDZWxsc1tpXS54KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGVmdENlbGxzOiBSZWN0YW5nbGVbXSA9IHRoaXMuZ3JpZC5maWx0ZXIoZ2MgPT4gZ2MueSA9PSB0aGlzLnNuYWtlQ2VsbHNbaV0ueSAmJiBnYy54IDwgdGhpcy5zbmFrZUNlbGxzW2ldLngpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zbmFrZUNlbGxzW2ldLnggPSBsZWZ0Q2VsbHNbMF0ueDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNuYWtlQ2VsbHNbaV0ueCA9IHJpZ2h0Q2VsbHNbcmlnaHRHcmlkQ2VsbEluZGV4XS54OyAgLy90aGlzLmdldE5leHRMZWZ0R3JpZENlbGwodGhpcy5zbmFrZUNlbGxzW2ldLngsIHRoaXMuc25ha2VDZWxsc1tpXS55KS54O1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2FzZSBcInVwXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBNb3ZlIHRoZSBzbmFrZSBjZWxsIHRvIHRoZSBwcmV2aW91cyB5LWNlbGwgaW4gdGhlIGdyaWRcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNuYWtlQ2VsbHNbaV0ueCA9IHRoaXMuc25ha2VDZWxsc1swXS54OyAvLyByZS1hbGlnbiBhbmQgZm9sbG93IHRoZSBoZWFkXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvcENlbGxzOiBSZWN0YW5nbGVbXSA9IHRoaXMuZ3JpZC5maWx0ZXIoZ2MgPT4gZ2MueSA8IHRoaXMuc25ha2VDZWxsc1tpXS55ICYmIGdjLnggPT0gdGhpcy5zbmFrZUNlbGxzW2ldLngpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0b3BHcmlkQ2VsbEluZGV4OiBudW1iZXIgPSB0aGlzLnNlYXJjaENsb3Nlc3RHcmlkQ2VsbEluZGV4KHRoaXMuc25ha2VDZWxsc1tpXS55LCB0b3BDZWxscyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCh0b3BHcmlkQ2VsbEluZGV4IDwgMCkgfHwgdG9wQ2VsbHNbdG9wR3JpZENlbGxJbmRleF0ueSA9PSB0aGlzLnNuYWtlQ2VsbHNbaV0ueSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIHN3aXRjaCBkaXJlY3Rpb25cclxuICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBib3R0b21DZWxsczogUmVjdGFuZ2xlW10gPSB0aGlzLmdyaWQuZmlsdGVyKGdjID0+IGdjLnkgPiB0aGlzLnNuYWtlQ2VsbHNbaV0ueSAmJiBnYy54ID09IHRoaXMuc25ha2VDZWxsc1tpXS54KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc25ha2VDZWxsc1tpXS55ID0gYm90dG9tQ2VsbHNbYm90dG9tQ2VsbHMubGVuZ3RoIC0xXS55O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc25ha2VDZWxsc1tpXS55ID0gdG9wQ2VsbHNbdG9wR3JpZENlbGxJbmRleF0ueTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgXHJcblxyXG4gICAgLy8gRmluZCB0aGUgY2xvc2VzdCBncmlkIGNlbGwgZnJvbSBvdXIgY3VycmVudCB4IHBvc2l0aW9uXHJcbiAgICBwcml2YXRlIHNlYXJjaENsb3Nlc3RHcmlkQ2VsbEluZGV4KGN1cnJlbnRYOiBudW1iZXIsIGdyaWRBcnJheTogUmVjdGFuZ2xlW10pOiBudW1iZXIge1xyXG4gICAgICAgXHJcbiAgICAgICBpZihncmlkQXJyYXkubGVuZ3RoID09IDApXHJcbiAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgdmFyIGN1cnJlbnRJbmRleDogbnVtYmVyID0gMDsgLy8gbnVtYmVyID0gZ3JpZEFycmF5WzBdLng7XHJcbiAgICAgICB2YXIgY3VycmVudFZhbHVlOiBudW1iZXIgPSBncmlkQXJyYXlbMF0ueDtcclxuICAgICAgIGZvcih2YXIgaTogbnVtYmVyID0gMDtpPGdyaWRBcnJheS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgIGlmIChNYXRoLmFicyhncmlkQXJyYXlbY3VycmVudEluZGV4XS54IC0gZ3JpZEFycmF5W2ldLngpIDwgTWF0aC5hYnMoY3VycmVudFggLSBncmlkQXJyYXlbY3VycmVudEluZGV4XS54KSlcclxuICAgICAgICAgICAgY3VycmVudEluZGV4ID0gaTtcclxuICAgICAgIH07XHJcbiAgICAgICByZXR1cm4gY3VycmVudEluZGV4O1xyXG4gICAgfVxyXG4gICAgXHJcblxyXG4gICAgZ3JpZDogUmVjdGFuZ2xlW107XHJcbiAgICBzbmFrZUNlbGxzOiBSZWN0YW5nbGVbXTtcclxuICAgIGRpcmVjdGlvbjogc3RyaW5nO1xyXG59IiwiaW1wb3J0IHsgR3JpZCB9IGZyb20gXCIuL0dyaWRcIjtcclxuaW1wb3J0IHsgU25ha2UgfSBmcm9tIFwiLi9TbmFrZVwiO1xyXG5pbXBvcnQgeyBSZWN0YW5nbGUgfSBmcm9tIFwiLi9SZWN0YW5nbGVcIjtcclxuXHJcbnZhciBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xyXG52YXIgY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XHJcbnZhciBncmlkOiBHcmlkID0gbmV3IEdyaWQoMjApO1xyXG52YXIgc25ha2U6IFNuYWtlO1xyXG52YXIgcmVjdDogUmVjdGFuZ2xlO1xyXG52YXIgY2FudmFzV2lkdGg6IG51bWJlciA9IDEyODA7XHJcbnZhciBjYW52YXNIZWlnaHQ6IG51bWJlciA9IDcyMDtcclxudmFyIGRyYXdHcmlkOiBib29sZWFuID0gZmFsc2U7XHJcbmZ1bmN0aW9uIGdhbWVMb29wKCkge1xyXG4gICAgIHZhciBpbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIFxyXG4gICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcclxuICAgICAgICBjdHguZmlsbFN0eWxlID0gXCJibGFja1wiO1xyXG4gICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBjYW52YXNXaWR0aCwgY2FudmFzSGVpZ2h0KTtcclxuICAgICAgICAvL3JlY3QuZHJhdyhjdHgsIDEyODAsIDcyMCk7XHJcbiAgICAgICAgaWYoZHJhd0dyaWQpXHJcbiAgICAgICAgICAgIGdyaWQuZHJhdyhjdHgsIGNhbnZhc1dpZHRoLCBjYW52YXNIZWlnaHQpO1xyXG4gICAgICAgIHNuYWtlLmRyYXcoY3R4LCBjYW52YXNXaWR0aCwgY2FudmFzSGVpZ2h0KTtcclxuICAgICAgICBcclxuICAgICB9LCAxMDApO1xyXG5cclxuICAgXHJcbn1cclxuXHJcbndpbmRvdy5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgIGNhbnZhcyA9IDxIVE1MQ2FudmFzRWxlbWVudD5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY252cycpO1xyXG4gICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xyXG4gICB2YXIgZ3JpZENlbGxzID0gZ3JpZC5nZW5lcmF0ZShjYW52YXNXaWR0aCwgY2FudmFzSGVpZ2h0KTtcclxuICAgc25ha2UgPSBuZXcgU25ha2UoZ3JpZENlbGxzKTtcclxuICAgcmVjdCA9IG5ldyBSZWN0YW5nbGUoMTAwLDEwMCwgNTAsIDUwLCBcImJsdWVcIik7XHJcbiAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIChlKSA9PiB7XHJcbiAgICAgICAgc3dpdGNoIChlLndoaWNoKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMzc6IHtcclxuICAgICAgICAgICAgICAgIHNuYWtlLmRpcmVjdGlvbiA9IFwibGVmdFwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSAzODoge1xyXG4gICAgICAgICAgICAgICAgc25ha2UuZGlyZWN0aW9uID0gXCJ1cFwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSAzOToge1xyXG4gICAgICAgICAgICAgICAgc25ha2UuZGlyZWN0aW9uID0gXCJyaWdodFwiO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSA0MDoge1xyXG4gICAgICAgICAgICAgICAgc25ha2UuZGlyZWN0aW9uID0gXCJkb3duXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIDMyOiB7XHJcbiAgICAgICAgICAgICAgICB0b2dnbGVEZWJ1Z01vZGUoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICB9KTsgICAgICAgICAgXHJcbiAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShnYW1lTG9vcCk7XHJcbiAgICBcclxufVxyXG5cclxuZnVuY3Rpb24gdG9nZ2xlRGVidWdNb2RlKCkge1xyXG4gICAgZHJhd0dyaWQgPSAoIWRyYXdHcmlkKTtcclxufSJdfQ==
